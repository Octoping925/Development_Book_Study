# 아이템 2. 생성자에 매개변수가 많다면 빌더를 고려하라

정적 팩토리와 생성자에는, 선택적 매개변수가 많을 때 적절히 대응하기 어렵다는 제약이 있다.

식품 포장의 영양 정보의 경우, 총 20개가 넘는 필드가 있지만, 대부분 제품은 이 선택 항목 중 대다수의 값이 그냥 0이다.

이런 클래스 용 생성자 혹은 팩토리는 어떤 모습일까? 프로그래머드릉ㄴ 점층적 생성자 패턴을 즐겨 사용했다. 필수 매개변수만 받는 생성자를 하나, 선택 매개변수를 받는 생성자를 여러 개 덧붙이는 방식이다.

하지만 매개변수가 많아지면 클라이언트 코드를 작성하기 어렵고, 읽기도 어렵다. 설정하기를 원치 않는 매개변수들도 일일이 기술해야 한다. 또한 매개변수의 순서도 중요하다. 매개변수가 많아지면 클라이언트가 헷갈리기 쉽다.

이런 문제를 해결하기 위해, 자바빈즈 패턴이라는 것이 있다. 자바빈즈 패턴은 객체를 생성한 다음, setter 메서드를 호출해 원하는 매개변수만 설정하는 방식이다. 이 방식은 매개변수가 많을 때 적합하다. 하지만, 객체 하나를 만들려면 메서드를 여러 개 호출해야 하고, 객체가 완전히 생성되기 전까지는 일관성이 무너진 상태에 놓이게 된다. 또한, 자바빈즈 패턴은 불변 객체를 만들 수 없다.

이것들 보다는 빌더 패턴이 더 나은 선택이다. 빌더 패턴은 객체 하나를 만들려면 메서드를 여러 개 호출해야 하지만, 객체가 완전히 생성되기 전까지는 일관성이 무너진 상태에 놓이지 않는다. 또한, 빌더 패턴은 불변 객체를 만들 수 있다.

빌더 패턴은 계층적으로 설계된 클래스와 함께 쓰기에 좋다. 각 계층의 클래스에 관련 빌더를 멤버로 정의하자. 추상 클래슨느 추상 빌더를, 구체 클래스는 구체 빌더를 갖게 한다. 다음은 피자의 다양한 종류를 표현하는 계층 구조의 루트에 놓인 추상 클래스다.

```java
public abstract class Pizza {
    public enum Topping { HAM, MUSHROOM, ONION, PEPPER, SAUSAGE }
    final Set<Topping> toppings;

    abstract static class Builder<T extends Builder<T>> {
        EnumSet<Topping> toppings = EnumSet.noneOf(Topping.class);
        public T addTopping(Topping topping) {
            toppings.add(Objects.requireNonNull(topping));
            return self();
        }
        abstract Pizza build();
        // 하위 클래스는 이 메서드를 재정의(overriding)해 "this"를 반환하도록 해야 한다.
        protected abstract T self();
    }

    Pizza(Builder<?> builder) {
        toppings = builder.toppings.clone(); // 아이템 50을 참고
    }
}
```

Pizza.Builder 클래스는 재귀적 타입 한정(아이템 30)을 이용하는 제네릭 타입이다. 여기에 추상 메소드인 self를 더해 하위 클래스에서는 형 변환하지 않고도 메소드 연쇄를 지원할 수 있다.

빌더 패턴은 상당히 유연하다. 빌더 하나로 여러 객체를 순회하면서 만들 수 있고, 빌더에 넘기는 매개변수에 따라 다른 객체를 만들 수도 있다. 객체를 생성할 때 자동으로 부여되는 일련번호와 같은 특정 필드는 빌더가 직접 설정하도록 할 수도 있다.
