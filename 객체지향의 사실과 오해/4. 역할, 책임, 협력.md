# 4. 역할, 책임, 협력

중요한 것은 개별 객체가 아니라 객체들 사이에 이루어지는 협력이다. 객체지향 설계의 전체적인 품질을 결정하는 것은 개별 객체의 품질이 아니라 여러 객체들이 모여 이뤄내는 협력의 품질이다. 훌륭한 객체지향 설계자는 객체들 간의 요청과 응답 속에서 창발하는 협력에 초점을 맞춰 애플리케이션을 설계한다. 협력이 자리를 잡으면 저절로 객체의 행동이 드러나고 뒤이어 적절한 객체의 상태가 결정된다.

객체의 책임은 객체가 ‘무엇을 알고 있는가’와 ‘무엇을 할 수 있는가’로 구성된다. 그리고 크레이그 라만은 객체의 책임을 이 두 가지로 자세히 분류하고 있다.

**하는 것**
1. 객체를 생성하거나 계산을 하는 등의 스스로 하는 것
2. 다른 객체의 행동을 시작시키는 것
3. 다른 객체의 활동을 제어하고 조절하는 것

**아는 것**
1. 개인적인 정보에 관해 아는 것
2. 관련된 객체에 관해 아는 것
3. 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

객체지향 설계의 예술은 적절한 객체에게 적절한 책임을 할당하는 데에 있다. 책임은 객체의 외부에 제공해줄 수 있는 정보 (아는 것)와 외부해 제공해줄 수 있는 서비스 (하는 것)의 목록이다. 따라서 책임은 객체의 공용 인터페이스 (public interface)를 구성한다. 공용 인터페이스의 개념은 객체지향의 중요한 원리 중 하나인 캡슐화로 이어진다.

어떤 객체가 수행하는 책임의 집합은 객체가 협력 안에서 수행하는 역할을 암시한다. 역할은 재사용 가능하고 유연한 객체지향 설계를 낳는 매우 중요한 구성요소이다. 역할은 협력 내에서 다른 객체로 대체할 수 있음을 나타내는 일종의 표식이다. 협력 안에서 역할은 “이 자리는 해당 역할을 수행할 수 있는 어떤 객체라도 대신할 수 있습니다”라고 말하는 것과 같다.

역할의 개념을 사용하면 유사한 협력을 추상화해서 인지 과부하를 줄일 수 있고, 다양한 객체들이 협력에 참여할 수 있어 협력이 좀 더 유연해지고 재사용성이 높아진다. 역할은 객체지향 설계의 단순성, 유연성, 재사용성을 뒷받침하는 핵심 개념이다.

시스템에 필요한 데이터를 저장하기 위해 객체가 존재한다는 것은 선입견이다. 객체가 상태의 일부로 데이터를 포함하는 것은 사실이지만, 이는 객체가 행위를 수행하는 데에 필요한 재료일 뿐이다. 객체가 존재하는 이유는 행위를 수행하며 협력에 참여하기 위해서다.

책임-주도 설계 (Responsibility-Driven Design)는 협력에 필요한 책임들을 식별하고 적합한 객체에게 책임을 할당하는 방식으로 앱을 설계한다. 시스템의 기능은 더 작은 규모의 책임으로 분할되고, 각 책임은 책임을 수행할 적절한 객체에게 할당된다. 객체가 책임을 수행하는 도중에 스스로 처리할 수 없는 정보나 기능이 필요한 경우 적절한 객체를 찾아 필요한 작업을 요청한다. 객체가 다른 객체에게 작업을 요청하는 행위를 통해 결과적으로 객체들 간의 협력 관계가 만들어진다. 만약 책임을 여러 종류의 객체가 수행할 수 있다면 협력자는 객체가 아니라 추상적인 역할로 대체된다. 이처럼 책임-주도 설계에서는 시스템의 책임을 객체의 책임으로 변환하고, 각 객체가 책임을 수행하는 중에 필요한 정보나 서비스를 제공해줄 협력자를 찾아 해당 협력자에게 책임을 할당하는 순차적인 방식으로 객체들의 협력 공동체를 구축한다.

디자인 패턴은 공통으로 사용할 수 있는 역할, 책임, 협력의 템플릿이다. 특정 상황에 적용 가능한 디자인 패턴을 잘 알고 있다면 책임-주도 설계의 절차를 순차적으로 따르지 않고도 시스템에 구현할 객체들의 역할, 책임, 협력 관계를 빠르고 손쉽게 포착할 수 있을 것이다. 디자인 패턴은 책임-주도 설계의 결과물인 동시에 지름길이다.

테스트-주도 개발 (Test-Driven Development)은 테스트를 먼저 작성하고 테스트를 통과하는 구체적인 코드를 추가하면서 앱을 완성해가는 방식을 따른다. 테스트 주도 개발은 테스트가 아니라 설계를 위한 기법이다. 테스트는 단지 테스트-주도 개발을 통해 얻을 수 있는 별도의 보너스 같은 것이며, 실제 목적은 구체적인 코드를 작성해나가면서 역할, 책임, 협력을 식별하고 식별된 역할, 책임, 협력이 적합한지를 피드백 받는 것이다. TDD의 기본 흐름은 실패하는 테스트를 작성하고, 테스트를 통과하는 가장 간단한 코드를 작성한 후 리팩토링을 통해 중복을 제거하는 것이다. (무슨 중복을 얘기하는 것인지?) TDD를 통해 ‘작동하는 깔끔한 코드’를 얻을 수 있다. TDD는 객체가 이미 존재한다고 가정하고, 객체에게 어떤 메시지를 전송할 것인지에 관해 먼저 생각하라고 충고한다. TDD는 테스트를 작성하는 것이 아니라, 책임을 수행할 객체 또는 클라이언트가 기대하는 객체의 역할이 메시지를 수신할 때 어떤 결과를 반환하고 그 과정에서 어떤 객체와 협력할 것인지에 대한 기대를 코드의 형태로 작성하는 것이다. 

TDD는 책임-주도 설계의 기본 개념을 따른다. 협력 안에서 객체의 역할과 책임이 무엇이고 이것이 클래스와 같은 프로그래밍 언어 장치로 구현되는 방식에 대한 감각을 갖춰야 효과적인 테스트를 작성할 수 있다.
